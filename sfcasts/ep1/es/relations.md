# Relaciones

Próximamente...

En nuestra aplicación, cada Tesoro del Dragón debe pertenecer a un único dragón o usuario de nuestro sistema. Así que olvidémonos de la API por un segundo y modelémoslo en la base de datos. Así que gira sobre ella y ejecuta Consola Bin, make entity. Y vamos a añadir nuestra modificar nuestra entidad Tesoro del Dragón porque nuestro tesoro del dragón necesita un propietario. Así que vamos a añadir una propiedad propietario y luego esto va a ser una relación mini a uno. Recuerda, si no estás seguro de qué relación necesitas, siempre puedes escribir relación, y te enviarán un asistente para ayudarte a averiguar cuál. Pero nosotros queremos una relación muchos-a-uno, y ésta va a ser relación con usuario. A continuación nos pregunta si la propiedad propietario del punto tesoro dragón puede ser nula. Todo tesoro dragón debe tener un propietario. Así que aquí voy a decir que no. Y luego nos pregunta si queremos mapear el otro lado de la relación. Así que básicamente, ¿queremos la capacidad de decir, flecha de usuario, consigue tesoros dragón en nuestro código? Voy a decir que sí a esto. Diría que sí a esto por dos razones. Una, puede ser útil tener esto en tu código. Y dos, como veremos un poco más adelante, esto nos va a permitir mostrar realmente los Tesoros del Dr. Dragón para un usuario cuando estemos utilizando, cuando estemos obteniendo nuestro recurso de usuario. Así que di que sí a eso. Y el nombre del campo dentro del usuario Tesoros del Dragón está bien. Por último, para la eliminación de huérfanos, di que no, vamos a hablar de la eliminación de huérfanos. Y

Más tarde, creo y lo hizo, entró a salir de eso.

Así que

Esto no tiene nada que ver con la plataforma APAP. Es muy sencillo. Nuestro tesoro dragón tiene ahora una nueva, veamos, propiedad owner con nuevos métodos get owner y set owner. Y encima en usuario tenemos una nueva propiedad Tesoros del Dragón, que es una Toman empaquetada a TR Tesoro del Dragón. Y en la parte inferior de aquí tenemos obtener Tesoros Dragón. Añadir Tesoro Dragón y quitar Tesoro Dragón. Cosas muy estándar. Muy bien, hagamos una migración para esta consola sinfónica. Haz la migración. Haremos nuestra doble comprobación estándar. Sí, tiene buena pinta. Y luego ejecuta esto con la doctrina de la consola Sinfonía. La migración migra y nos explota en la cara. Vale, no debería ser demasiado sorprendente. Tenemos un montón de Tesoros del Dragón en la base de datos ERO cuando intentamos añadir el ID de propietario a la tabla donde no está Nu, nuestra base de datos no tiene ni idea de qué valor poner para esos tesoros del Dragón existentes. Si esto ya estuviera en producción, tendríamos que hacer un poco más de trabajo. Y hablamos de ello en nuestro tutorial de doctrina, doctrina. Pero como esto aún no está en producción, lo más fácil es resetear completamente la base de datos. Así que voy a ejecutar la consola Sinfonía base de datos doctrina,

Luego base de datos doctrina, crear, luego Doctrine, migraciones Migrar, que ahora funcionará ya que nuestra base de datos no tiene ninguna rosa en su interior. Por último, ejecuta la Consola Symphony Doctrine Fixtures Load. Así obtendremos nuevos datos. Y oh, esto falla por la misma razón que intenta crear Tesoros Dragón sin propietario. Así que para solucionarlo, en realidad hay dos formas en las que me gusta hacer las dos cosas en la Fábrica de Tesoros Dragón y obtener los valores predeterminados. Añadiremos un nuevo campo de propietario aquí y lo llamaremos Llamada a la Fábrica de Usuarios. No, no voy a entrar en los detalles de fa uh, fundador tiene muy buena documentación sobre cómo trabajar con las relaciones, pero esto es básicamente va a asegurarse de que si l pero lo que esto haría si no hiciéramos nada más, esto crearía un nuevo usuario cada vez que creó un Tesoro Dragón y relacionarlos. Así que está bien tener eso por defecto. Pero en nuestra aplicación fija, voy a hacer algo un poco más guay. Vamos a mover Tesoro Dragón después de Fábrica de Usuarios y a pasar un segundo argumento aquí, que es una forma de anular los valores por defecto cada vez. Así que al pasar una llamada de retorno cada vez, deberá llamar a esta llamada de retorno 40 veces.

Y aquí podemos devolver un array de datos que deberían anular esos valores por defecto. Así que voy a decir propietario y podemos decir fábrica de usuarios llamar a, llamar a aleatorio. Así está bien. Encontrará un objeto usuario aleatorio y lo establecerá como propietario. Así que tendremos 40 tesoros Dragón asignados cada uno a uno, asignados aleatoriamente a uno de estos 10 usuarios. Muy bien, prueba a cargar de nuevo los accesorios de doctrina de la Consola Sinfónica. Esta vez funciona. Así que en un nivel muy alto, todo lo que básicamente acabamos de hacer fue añadir una nueva propiedad propietario a Tesoro Dragón y una nueva propiedad Tesoros Dragón, propiedad sobre a usuario. Así que no debería sorprendernos demasiado si vamos y hacemos, usamos nuestra ruta final Obtener colección para nuestros tesoros, el nuevo campo de propiedad no aparece en nuestra api. Es lógico que la propiedad no esté dentro de nuestro grupo de normalización. Así que si queremos exponer la propiedad owner en la api, como cualquier otro campo, tenemos que añadirle grupos. Así que voy a copiar los grupos de Cool Factor y pegarlos aquí. Esto significa que podremos establecer el propietario cuando establezcamos el propietario y también que se nos devolverá el propietario.

Y sí, más adelante aprenderemos a establecer el propietario automáticamente para que no tengas que hacerlo, para que el usuario de la API A no tenga que enviarlo. Pero por ahora, dejaremos que lo establezcan manualmente. Muy bien, probemos esto. Ni siquiera refrescaré, sólo pulsaré ejecutar y hermoso. Tiene propietario y muy interesante. Está establecido en una url. Hablaremos más de esto, pero ese es el comportamiento por defecto. Cuando tienes relaciones, se establece, no se establece en la API Platform. Podrías simplemente establecerlo al, ID como propietario uno, pero esto es mucho más útil porque esto le dice a tu cliente API a dónde podría ir para obtener más información sobre ese propietario. Muy bien, vamos a intentar escribir ese campo. Así que déjame cerrar esta ruta. Vamos a crear un nuevo tesoro dragón. Di tesoro dragón. Muy valioso. Superguay. Oh, ¿sabes qué? En realidad aún no veo mi ID de propietario aquí. Podría añadirlo manualmente. Quiero actualizar. Voy a copiarlo y actualizarlo rápidamente porque quiero que todos veáis que el propietario aparece ahí

Desde que lo añadimos a nuestro grupo. Así que voy a pegar eso y ahora añadiré el propietario. Y para el propietario, vamos a buscar un ID aquí abajo en nuestro, vale, genial. Tengo un propietario cuyo ID es sólo uno. Así que pondré uno justo ahí. Pulsa ejecutar y veamos. Ah, código de estado 400. Y mira esto. Esperado I r I o documento anidado para atributo propietario entero dado. Así que lo pasé. El ID del propietario no le gusta. ¿Qué ponemos aquí? Bueno, nos lo dice en iri, claro, qué demonios no es I, I, vamos a averiguarlo a continuación.
