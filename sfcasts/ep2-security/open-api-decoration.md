# Open Api Decoration

Coming soon...

To use our A API token in swagger, we have to actually type the word bearer and then the a P I token, which is just annoying, especially if I intend for this to be used by real users. So how could we fix that? Well, just a reminder that swagger is entirely generated from the open API spec document that API platform builds. You can see this spec document by either viewing the page source, you can see it all right there or by going to slash slash docs dot json. And here we go. So a moment ago we added some configuration API platform called authorization and the end result of that is that it added this, these security sections down here. So we had this config here. All that did was add these sections down here. Our swagger documentation then reads that and knows to like to make this authorization available. So I did some digging directly on open API and I find out, found out that the open API spec does have a way to define an auth authentication where you do not need to pass the bearer part manually. It's added for you automatically. Unfortunately, API platform's configuration doesn't support that. So are we done for The answer is no and for an awesome reason.

So to create this documentation that you see here, API platform creates an open API object, populates all this data on that open API object and then sends it through this serializer. This is important because we can modify that object before it goes through the serializer and make whatever changes we want. So this open API object is created via an open API factory service and to hook into this process, we can decorate that service. So check this out Over here in the source directory, I'm gonna create a new directory called API platform and inside there a new piece for class called Open API factory decorator. And then we need to make this implement open API factory interface. Then I'll go to code generate or command N on the Mac to implement the one method we need which is actually invoke. So right now internally there is an open API factory service in the core of ACAP platform and it

Creates the open API object with all this data on it. What we are gonna do is actually tell Symphony to use our new class as the open API factory instead of the core one. But of course we don't wanna reimplement all of this logic, right? That would be crazy. So what we're gonna have it do is pass us the original open API factory into this class. So we can call it, this is called decoration. It's an object oriented strategy and it's something that is really easy to do in Symphony. So check this out. Whenever you do decoration, you're always gonna create a constructor that accepts the interface that you're decorating. So open API factory interface, those are both the same. And I'll call this decorated. Oh, and let me put, lemme put private in front of that. Perfect. And then down here to start, we'll say open API equals this arrow decorated. And then we can call that invoke method and pass the same argument that we have here Context. So that's gonna call the core one to PA and it will create the open API object and down here we'll return that and in between, that's where we can mess with it. So just to start, I'm going to dump the open API object.

Now if we just stopped here, this class is set up for decoration, but symphony's service container isn't gonna use this. It's still set up to use the core open API factory. It's not gonna use our class at all to tell Symphony to use our class as the open API factory. But then pass us the old one. We need a little annotation up here called as decorator hit tab to Abbot You statement. And right here we need to put the service ID of the original open API factory. You can do some digging to find this or usually you can just find it in the documentation. Um, API platform actually documents decorating the service. So right in their documentation you can see that the name of this service is API platform.open API dot factory. So this means that our service will actually become the service but the old one will be passed to us. So awesome. Alright, to see if this is working, let's actually go to the homepage. I'll refresh and yep, sure enough down there to generate the open API API document, open API documentation in the background and call our code and it hit look at this says everything on it, including security that we see inside of our spot here. So now we can just tweak that.

So the code I'm gonna put here is a little bit specific to the Open API object and also the exact configuration that I know we need in open API to make this happen. So we'll create the security, get the security schemes configuration, and then I'm gonna override the access token. This is matching the name that I created right here instead that to a new security scheme. And here we're gonna pass this two arguments. I'll pass that named arguments type http and scheme bearer. That's kind of the exact config that we need and they'll return open API on the bottom. That's it. So let's try it. First of all, if you refresh the documentation down here in the bottom, let me search for bear actually, there we go. You can see with, we've actually modified what the configuration looks like right here and over here when we check it. Yes, look at Access token HTP Bear. Let's go steal our API token over here. Paste it can authorize. And now if we try, here we go. Let me try that APA N point. Whoops. I'm going too fast. Beautiful. Look at authorization bear. It passed the bear for us. Awesome. Now you might think because we are kind of completely overriding the access token configuration inside of here that we could just delete it for subtle reasons that have to do with how the documentation in this case is generated. We can't do that. We, we actually need this config,

But I'll say overridden in open API factory decorator. So this is just one example of changing something on your open API documentation, but if you have some more advanced use case and you need to do that, this is a way that you can do it. All right, next, let's talk about scopes.