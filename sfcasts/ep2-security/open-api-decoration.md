# Open Api Decoration

Coming soon...

To use our API token in Swagger, we have to actually type the word "Bearer" and then the API token, which is just annoying, especially if I intend for this to be used by real users. So how could we fix that? Well, just a reminder that Swagger is entirely generated from the Open API spec document that API Platform builds. You can see this spec document by either viewing the page source, you can see it all right there or by going to `/api/docs.json`. And here we go. So a moment ago we added some configuration API Platform called `Authorization` and the end result of that is that it added this, these security sections down here. So we had this config here. All that did was add these sections down here. Our Swagger documentation then reads that and knows to like to make this "authorization" available. So I did some digging directly in Open API and I found out that the Open API spec does have a way to define an authentication where you do not need to pass the "Bearer" part manually. It's added for you automatically. Unfortunately, API Platform's configuration doesn't support that. So are we done for The answer is no and for an awesome reason.

So to create this documentation that you see here, API Platform creates an `OpenApi` object, populates all this data on that `OpenApi` object and then sends it through the serializer. This is important because we can modify that object before it goes through the serializer and make whatever changes we want. So this `OpenApi` object is created via an `OpenApiFactory` and to hook into this process, we can decorate that service. So check this out. Over here in the `src/` directory, I'm going to create a new directory called `ApiPlatform` and inside there a new PHP class called `OpenApiFactoryDecorator`. And then we need to make this implement `OpenApiFactoryInterface`. Then I'll go to Code -> Generate or command + N on a Mac to implement the one method we need which is actually `__invoke()`. So right now internally there is an `OpenApiFactory` service in the core of API Platform and it

Creates the `OpenApi` object with all this data on it. What we are going to do is actually tell Symfony to use our new class as the `OpenApiFactory` instead of the core one. But of course we don't want to reimplement all of this logic, right? That would be crazy. So what we're going to have it do is pass us the original `OpenApiFactory` into this class. So we can call it, this is called decoration. It's an object-oriented strategy and it's something that is really easy to do in Symfony. So check this out. Whenever you do decoration, you're always going to create a constructor that accepts the interface that you're decorating. So `OpenApiFactoryInterface`, those are both the same. And I'll call this `$decorated`. Oh, and let me put `private` in front of that. Perfect. And then down here to start, we'll say `$openApi = $this->decorated`. And then we can call that `__invoke()` method and pass the same argument that we have here `$context`. So that's going to call the core one to and it will create the `OpenApi` object and down here we'll return that and in between, that's where we can mess with it. So just to start, I'm going to dump the `OpenApi` object.

Now if we just stopped here, this class is set up for decoration, but Symfony's service container isn't going to use this. It's still set up to use the core `OpenApiFactory`. It's not going to use our class at all to tell Symfony to use our class as the `OpenApiFactory`. But then pass us the old one. We need a little annotation up here called `#[AsDecorator]` hit tab to add that `use` statement. And right here we need to put the service ID of the original `OpenApiFactory`. You can do some digging to find this or usually you can just find it in the documentation. Um, API platform actually documents decorating the service. So right in their documentation you can see that the name of this service is `api_platform.openapi.factory`. So this means that our service will actually become this service but the old one will be passed to us. So awesome. Alright, to see if this is working, let's actually go to the homepage. I'll refresh and yep, sure enough down there to generate the open API API document, open API documentation in the background it called our code and it hit. Look at this it has everything on it, including security that we see inside of our spot here. So now we can just tweak that.

So the code I'm going to put here is a little bit specific to the `OpenApi` object and also the exact configuration that I know we need in Open API to make this happen. So we'll create the security, get the `$securitySchemes` configuration, and then I'm going to override the `access_token`. This is matching the name that I created right here. And set that to a new `SecurityScheme()`. And here we're going to pass this two arguments. I'll pass that named arguments `type: 'http'` and `scheme: 'bearer'`. That's kind of the exact config that we need and then we'll return `$openApi` on the bottom. That's it. So let's try it. First of all, if you refresh the documentation down here on the bottom, let me search for "Bearer" actually, there we go. You can see we've actually modified what the configuration looks like right here and over here when we check it. Yes, look `access_token`, `http`, `Bearer`. Let's go steal our API token over here. Paste it hit "Authorize". And now if we try, here we go. Let me try that API endpoint. Whoops. I'm going too fast. Beautiful. Look at `Authorization: Bearer`. It passed the `Bearer` for us. Awesome. Now you might think because we are kind of completely overriding the `access_token` configuration inside of here that we could just delete it for subtle reasons that have to do with how the documentation in this case is generated. We can't do that. We, we actually need this config,

But I'll say `overridden in OpenApiFactoryDecorator`. So this is just one example of changing something on your Open API documentation, but if you have some more advanced use-case and you need to do that, this is a way that you can do it. All right, next, let's talk about scopes.
