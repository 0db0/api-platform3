We've got things set up so that only the owner of a treasure can edit it. So new requirement, admin users can also edit any treasure. That's a user that has a role underscore admin. Let's create a test for this. So how about `public function testAdminCanPatchToEditTreasure()` And of course, what we need to start here is we need to create an admin user and we'll do that with `UserFactory::createOne()`. We'll pass that role as `'role_admin'`. And that will work just fine. Though if we need to create lots of admin users in our tests, we can actually use a nice feature of Foundry to clean this up a bit. So I'm going to go into `UserFactory.php`. We're going to create something called a state method. This can go anywhere inside of here. It's going to be a public function. You can call it anything you want, but it's going to be a nice function that we can call to easily modify some data about the user we're creating. So for example, we could create a new method called `withRoles()` or we pass it an array of roles and then we return self. That's just for convenience. And inside, we can say `return $this->addState(['roles' => $roles]);`. What this is going to do is when we call this, if we pass it an array of roles, `addState()` is going to basically take what we passed to `addState()` is going to become new data that's used to create this user. So when we create this, we can say, this is going to change a little bit. Now we can say `UserFactory::new()`. Instead of creating an object, that actually creates a new instance of our userFactory. And then of course, we can call any methods on what we want, like `withRoles()`, `'role_admin'`. So we're kind of crafting what we want the user to look like. And then finally, when we're done, we'll call `create()`. Not `createOne()` in this case, `createOne()` is a static method. So I'm going to call `createOne()`, that's a static method on a userFactory. Once we have an instance of userFactory, if we want to create one, it's called `create()`. So it's just a nice little way to make things a little bit more explicit. But we can go even further. For example, in `UserFactory.php`, we can create another state method called `asAdmin()`. That returns self, and then return this arrow withRoles, `roleAdmin`. So this is going to make our test even more readable, because we can just now say `UserFactory::new()->asAdmin()->create()`, and done. All right, let's actually put the test together now. So let's create a new treasure set to dragon `DragonTreasureFactory::createOne()`, because we're not passing any user that's going to be, it will create a new user in the background and assign it. So that means the admin user will not be the owner. And then this arrow browser, arrow acting as the admin user. And then we're going to patch to slash API slash treasures slash treasure arrow getID. Sending some JSON. And we'll just do that same value, one, two, three, four, five that we did before. Assert status 200 and `assertJsonMatches()` value one, two, three, four, five. All right, let's try this. I'm going to copy that test name. We're on symphony PHP bin slash PHP unit dash dash filter equals. And okay, as expected, we haven't done anything to allow this yet. So we get a 403 status code. How do we fix this? Well, at first, it's relatively easy, right? We have total control via this expression here. So we can do something like `if granted roleAdmin`, or and then put parentheses around the other use case. But this is going to work. But I know it looks a little crazy. Let's try the test first. And 500 error. Hmm, let's check out and see what's going on. I'll click to open this. The token name or value around position 26. So that was an accident, but it actually brings up a really good point. So I didn't want `or` in capitals, that's like an SQL query I wanted. `or` is lowercase. And now it still fails. Oh, of course, because I need to also put it down here. So those two mistakes I made it works now were actual real accidents just now, but it actually brings home a good point. These the security is getting complex here. These expressions are powerful, but not very readable, easy to make a mistake. So next, let's clean and centralize this with a voter.